const logger = require('pino')({ level: process.env.LOG_LEVEL || 'info' });

/**
 * Optimized Message Templates - Hindi Only (Updated Version)
 * 
 * Features:
 * - Custom Hindi templates only
 * - Modular template structure
 * - Dynamic template selection
 * - Template caching for performance
 * - Location added to all signatures
 */
class MessageTemplates {
    constructor() {
        this.templates = {
            // PROMOTIONAL MESSAGES ONLY - Other templates commented out for festival campaign
            
            /*
            // Core Order Templates - DISABLED for promotional campaign
            welcome: this.getWelcomeTemplate(),
            order_confirmation: this.getOrderConfirmationTemplate(),
            order_ready: this.getOrderReadyTemplate(),
            delivery_notification: this.getDeliveryNotificationTemplate(),
            
            // Reminder Templates - DISABLED for promotional campaign
            pickup_reminder: this.getPickupReminderTemplate(),
            payment_reminder: this.getPaymentReminderTemplate(),
            
            // Fabric Templates - DISABLED for promotional campaign
            fabric_welcome: this.getFabricWelcomeTemplate(),
            fabric_purchase: this.getFabricPurchaseTemplate(),
            fabric_payment_reminder: this.getFabricPaymentReminderTemplate(),
            
            // Combined Templates - DISABLED for promotional campaign
            combined_order: this.getCombinedOrderTemplate(),
            
            // Special Templates - DISABLED for promotional campaign
            pickup_complete: this.getPickupCompleteTemplate(),
            */
            
            // Festival Promotional Templates - ACTIVE
            durga_puja_dussehra_offer: this.getDurgaPujaDussehraOfferTemplate()
        };
        
        // Template cache for performance
        this.templateCache = new Map();
        
        console.log('ЁЯОЙ PROMOTIONAL CAMPAIGN MODE - Festival Templates Only');
        console.log(`ЁЯУЭ Active template types: ${Object.keys(this.templates).length} (Promotional Only)`);
        console.log('ЁЯЪл Regular business templates are DISABLED for promotional campaign');
    }

    // Core Order Templates
    getWelcomeTemplate() {
        return `ЁЯЩП *RS Tailor & Fabric рдореЗрдВ рдЖрдкрдХрд╛ рд╣рд╛рд░реНрджрд┐рдХ рд╕реНрд╡рд╛рдЧрдд рд╣реИ* ЁЯЩП

рдкреНрд░рд┐рдп *{customer_name}* рдЬреА,

рдЖрдкрдХрд╛ рд╣рдорд╛рд░реЗ рдкрд░рд┐рд╡рд╛рд░ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдирд╛ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдЧрд░реНрд╡ рдХреА рдмрд╛рдд рд╣реИ! 

тЬи *рд╣рдорд╛рд░реА рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ:*
- 20+ рд╕рд╛рд▓ рдХрд╛ рдЕрдиреБрднрд╡
- рдмреЗрд╣рддрд░реАрди рдлрд┐рдЯрд┐рдВрдЧ рдХреА рдЧрд╛рд░рдВрдЯреА  
- рд╕рдордп рдкрд░ рдбрд┐рд▓реАрд╡рд░реА
- рдЙрдЪреНрдЪ рдЧреБрдгрд╡рддреНрддрд╛ рдХреЗ рдХрдкрдбрд╝реЗ
- Wedding/Festival рд╕реНрдкреЗрд╢рд▓ рдХрд▓реЗрдХреНрд╢рди

ЁЯУН *рджреБрдХрд╛рди рдХрд╛ рдкрддрд╛:* Main Market, Kumher
тП░ *рд╕рдордп:* рд╕реБрдмрд╣ 10 рд╕реЗ рд░рд╛рдд 8 рдмрдЬреЗ (рд╕рд╛рддреЛрдВ рджрд┐рди)
ЁЯУЮ *рд╕рдВрдкрд░реНрдХ:* {shop_phone}

ЁЯТб *рдЖрдкрдХреЛ рдорд┐рд▓реЗрдВрдЧреЗ:*
- Order рдХреА рдкреВрд░реА рдЬрд╛рдирдХрд╛рд░реА WhatsApp рдкрд░
- рддреИрдпрд╛рд░ рд╣реЛрдиреЗ рдкрд░ рддреБрд░рдВрдд рд╕реВрдЪрдирд╛
- Special offers рдХреА рдЬрд╛рдирдХрд╛рд░реА

рдЖрдкрдХреЗ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж! ЁЯМЯ

*RS Tailor & Fabric*
Main Market, Kumher`;
    }

    getOrderConfirmationTemplate() {
        return `тЬЕ *рдЖрдкрдХрд╛ рдСрд░реНрдбрд░ рдХрдиреНрдлрд░реНрдо рд╣реЛ рдЧрдпрд╛ рд╣реИ* тЬЕ

рдкреНрд░рд┐рдп *{customer_name}* рдЬреА,

рдЖрдкрдХрд╛ рдСрд░реНрдбрд░ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдмреБрдХ рд╣реЛ рдЧрдпрд╛ рд╣реИ рдФрд░ рд╣рдордиреЗ рдХрд╛рдо рд╢реБрд░реВ рдХрд░ рджрд┐рдпрд╛ рд╣реИред ЁЯкбтЬВя╕П

ЁЯУЛ *рдСрд░реНрдбрд░ рд╡рд┐рд╡рд░рдг:*
- рдСрд░реНрдбрд░ рдирдВрдмрд░: #{order_id}
- рдХрдкрдбрд╝реЗ рдХрд╛ рдкреНрд░рдХрд╛рд░: {garment_type}
- рдмреБрдХрд┐рдВрдЧ рджрд┐рдирд╛рдВрдХ: {order_date}

ЁЯТ░ *рднреБрдЧрддрд╛рди рд╡рд┐рд╡рд░рдг:*
- рдХреБрд▓ рд░рд╛рд╢рд┐: тВ╣{total_amount}
- рдПрдбрд╡рд╛рдВрд╕ рдЬрдорд╛: тВ╣{advance_payment} тЬУ
- рд╢реЗрд╖ рд░рд╛рд╢рд┐: тВ╣{remaining_amount}

ЁЯОп *рд╡рд┐рд╢реЗрд╖ рдиреЛрдЯ:* {notes}

ЁЯУв рддреИрдпрд╛рд░ рд╣реЛрддреЗ рд╣реА рдЖрдкрдХреЛ рд╕реВрдЪрдирд╛ рднреЗрдЬ рджреА рдЬрд╛рдПрдЧреАред

рдХрд┐рд╕реА рднреА рдкреНрд░рд╢реНрди рдХреЗ рд▓рд┐рдП рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВ: {shop_phone}

рдзрдиреНрдпрд╡рд╛рдж! ЁЯЩП
*RS Tailor & Fabric*
Main Market, Kumher`;
    }

    getOrderReadyTemplate() {
        return `ЁЯОЙ *рдЦреБрд╢рдЦрдмрд░реА! рдЖрдкрдХрд╛ рдХрдкрдбрд╝рд╛ рддреИрдпрд╛рд░ рд╣реИ* ЁЯОЙ

рдкреНрд░рд┐рдп *{customer_name}* рдЬреА,

рдЖрдкрдХрд╛ {garment_type} рдкреВрд░реА рддрд░рд╣ рд╕реЗ рддреИрдпрд╛рд░ рд╣реИ рдФрд░ рдЖрдкрдХрд╛ рдЗрдВрддрдЬрд╝рд╛рд░ рдХрд░ рд░рд╣рд╛ рд╣реИ! тЬи

ЁЯУЛ *рд╡рд┐рд╡рд░рдг:*
- рдСрд░реНрдбрд░ рдирдВрдмрд░: #{order_id}
- рддреИрдпрд╛рд░ рджрд┐рдирд╛рдВрдХ: {ready_date}
- рдХрдкрдбрд╝реЗ рдХрд╛ рдкреНрд░рдХрд╛рд░: {garment_type}

ЁЯТ│ *рднреБрдЧрддрд╛рди рд╕реНрдерд┐рддрд┐:*
- рдХреБрд▓ рд░рд╛рд╢рд┐: тВ╣{total_amount}
- рдЬрдорд╛ рд░рд╛рд╢рд┐: тВ╣{advance_payment}
- рджреЗрдп рд░рд╛рд╢рд┐: тВ╣{remaining_amount}

ЁЯПк *рдкрд┐рдХрдЕрдк рдЯрд╛рдЗрдорд┐рдВрдЧ:*
- рд╕реБрдмрд╣ 10 рд╕реЗ рд░рд╛рдд 8 рдмрдЬреЗ
- рдлреЛрди: {shop_phone}

тнР *рдорд╣рддреНрд╡рдкреВрд░реНрдг:* рдХреГрдкрдпрд╛ 3 рджрд┐рди рдХреЗ рдЕрдВрджрд░ рдЕрдкрдирд╛ рдСрд░реНрдбрд░ рд▓реЗ рдЬрд╛рдПрдВред

*RS Tailor & Fabric*
Main Market, Kumher`;
    }

    getDeliveryNotificationTemplate() {
        return `тЬи *рдбрд┐рд▓реАрд╡рд░реА рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдкреВрд░реНрдг* тЬи

рдкреНрд░рд┐рдп *{customer_name}* рдЬреА,

рдЖрдкрдХрд╛ рдСрд░реНрдбрд░ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдбрд┐рд▓реАрд╡рд░ рд╣реЛ рдЧрдпрд╛ рд╣реИред рд╣рдореЗрдВ рдЙрдореНрдореАрдж рд╣реИ рдЖрдкрдХреЛ рд╣рдорд╛рд░рд╛ рдХрд╛рдо рдкрд╕рдВрдж рдЖрдпрд╛ рд╣реЛрдЧрд╛! 

ЁЯУЛ *рдбрд┐рд▓реАрд╡рд░реА рд╡рд┐рд╡рд░рдг:*
- рдСрд░реНрдбрд░ рдирдВрдмрд░: #{order_id}
- рдбрд┐рд▓реАрд╡рд░реА рджрд┐рдирд╛рдВрдХ: {delivery_date}
- рдХрдкрдбрд╝рд╛: {garment_type}

ЁЯТ░ *рднреБрдЧрддрд╛рди рд╕рд╛рд░рд╛рдВрд╢:*
- рдХреБрд▓ рд░рд╛рд╢рд┐: тВ╣{total_amount}
- рдкреНрд░рд╛рдкреНрдд рд░рд╛рд╢рд┐: тВ╣{paid_today}
- рдмрдХрд╛рдпрд╛ рд░рд╛рд╢рд┐: тВ╣{remaining_amount}

ЁЯМЯ *рджреЗрдЦрднрд╛рд▓ рдХреЗ рдЯрд┐рдкреНрд╕:*
- рдкрд╣рд▓реА рдмрд╛рд░ рдбреНрд░рд╛рдИ рдХреНрд▓реАрди рдХрд░рд╡рд╛рдПрдВ
- рдЙрд▓реНрдЯрд╛ рдХрд░рдХреЗ рдкреНрд░реЗрд╕ рдХрд░реЗрдВ
- рдзреВрдк рдореЗрдВ рд╕реАрдзреЗ рди рд╕реБрдЦрд╛рдПрдВ

тнР рдХреГрдкрдпрд╛ Google рдкрд░ рдЕрдкрдирд╛ рдЕрдиреБрднрд╡ рд╢реЗрдпрд░ рдХрд░реЗрдВ!

рдлрд┐рд░ рдорд┐рд▓реЗрдВрдЧреЗ! ЁЯЩП
*RS Tailor & Fabric*
Main Market, Kumher`;
    }

    // Reminder Templates
    getPickupReminderTemplate() {
        return `ЁЯФФ *рд░рд┐рдорд╛рдЗрдВрдбрд░: рдЖрдкрдХрд╛ рдСрд░реНрдбрд░ рддреИрдпрд╛рд░ рд╣реИ* ЁЯФФ

рдкреНрд░рд┐рдп *{customer_name}* рдЬреА,

рдЖрдкрдХрд╛ {garment_type} рдкрд┐рдЫрд▓реЗ {days_since_ready} рджрд┐рдиреЛрдВ рд╕реЗ рддреИрдпрд╛рд░ рд╣реИ рдФрд░ рдЖрдкрдХрд╛ рдЗрдВрддрдЬрд╝рд╛рд░ рдХрд░ рд░рд╣рд╛ рд╣реИред 

ЁЯУЛ *рдСрд░реНрдбрд░: #{order_id}*
ЁЯТ░ *рдмрдХрд╛рдпрд╛ рд░рд╛рд╢рд┐: тВ╣{remaining_amount}*

рдХреГрдкрдпрд╛ рдЬрд▓реНрдж рд╕реЗ рдЬрд▓реНрдж рдЕрдкрдирд╛ рдСрд░реНрдбрд░ рд▓реЗ рдЬрд╛рдПрдВред ЁЯЩП

тП░ рджреБрдХрд╛рди рдЦреБрд▓реА рд╣реИ: 10 AM - 8 PM

рдлреЛрди: {shop_phone}
*RS Tailor & Fabric*
Main Market, Kumher`;
    }

    getPaymentReminderTemplate() {
        return `ЁЯТ│ *рднреБрдЧрддрд╛рди рд░рд┐рдорд╛рдЗрдВрдбрд░* ЁЯТ│

рдкреНрд░рд┐рдп *{customer_name}* рдЬреА,

рдЖрдкрдиреЗ {pickup_date} рдХреЛ рдЕрдкрдирд╛ {garment_type} (рдСрд░реНрдбрд░ #{order_id}) рд▓реЗ рд▓рд┐рдпрд╛ рдерд╛ред

ЁЯТ░ *рдмрдХрд╛рдпрд╛ рд░рд╛рд╢рд┐: тВ╣{remaining_amount}*

рдХреГрдкрдпрд╛ рдЕрдкрдиреА рд╕реБрд╡рд┐рдзрд╛ рдЕрдиреБрд╕рд╛рд░ рднреБрдЧрддрд╛рди рдХрд░ рджреЗрдВ:

ЁЯУ▒ *UPI/Online:* 8824781960@paytm
ЁЯТ╡ *Cash:* рджреБрдХрд╛рди рдкрд░

рднреБрдЧрддрд╛рди рдХреЗ рдмрд╛рдж "PAID" рд▓рд┐рдЦрдХрд░ рднреЗрдЬреЗрдВред

рдзрдиреНрдпрд╡рд╛рдж! ЁЯЩП
*RS Tailor & Fabric*
Main Market, Kumher`;
    }

    // Fabric Templates
    getFabricWelcomeTemplate() {
        return `ЁЯЩП *RS Tailor & Fabric рдореЗрдВ рдЖрдкрдХрд╛ рд╣рд╛рд░реНрджрд┐рдХ рд╕реНрд╡рд╛рдЧрдд рд╣реИ* ЁЯЩП

рдкреНрд░рд┐рдп *{customer_name}* рдЬреА,

рдЖрдкрдХрд╛ рд╣рдорд╛рд░реЗ рдкрд░рд┐рд╡рд╛рд░ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдирд╛ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдЧрд░реНрд╡ рдХреА рдмрд╛рдд рд╣реИ! 

тЬи *рд╣рдорд╛рд░реА рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ:*
- 20+ рд╕рд╛рд▓ рдХрд╛ рдЕрдиреБрднрд╡
- рдмреЗрд╣рддрд░реАрди рдлрд┐рдЯрд┐рдВрдЧ рдХреА рдЧрд╛рд░рдВрдЯреА  
- рд╕рдордп рдкрд░ рдбрд┐рд▓реАрд╡рд░реА
- рдЙрдЪреНрдЪ рдЧреБрдгрд╡рддреНрддрд╛ рдХреЗ рдХрдкрдбрд╝реЗ
- Wedding/Festival рд╕реНрдкреЗрд╢рд▓ рдХрд▓реЗрдХреНрд╢рди

ЁЯУН *рджреБрдХрд╛рди рдХрд╛ рдкрддрд╛:* Main Market, Kumher
тП░ *рд╕рдордп:* рд╕реБрдмрд╣ 10 рд╕реЗ рд░рд╛рдд 8 рдмрдЬреЗ (рд╕рд╛рддреЛрдВ рджрд┐рди)
ЁЯУЮ *рд╕рдВрдкрд░реНрдХ:* {shop_phone}

ЁЯТб *рдЖрдкрдХреЛ рдорд┐рд▓реЗрдВрдЧреЗ:*
- Order рдХреА рдкреВрд░реА рдЬрд╛рдирдХрд╛рд░реА WhatsApp рдкрд░
- рддреИрдпрд╛рд░ рд╣реЛрдиреЗ рдкрд░ рддреБрд░рдВрдд рд╕реВрдЪрдирд╛
- Special offers рдХреА рдЬрд╛рдирдХрд╛рд░реА

рдЖрдкрдХреЗ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж! ЁЯМЯ

*RS Tailor & Fabric*
Main Market, Kumher`;
    }

    getFabricPurchaseTemplate() {
        return `ЁЯЫНя╕П *рдХрдкрдбрд╝рд╛ рдЦрд░реАрджреА рдХреА рдкреБрд╖реНрдЯрд┐* ЁЯЫНя╕П

рдкреНрд░рд┐рдп *{customer_name}* рдЬреА,

рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдЪреБрдирд╛ рдЧрдпрд╛ рдкреНрд░реАрдорд┐рдпрдо рдХрдкрдбреЗ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ! тЬи

ЁЯУж *рдЦрд░реАрджреА рд╡рд┐рд╡рд░рдг:*
- рдСрд░реНрдбрд░ рдирдВрдмрд░: #F{order_id}
- рдорд╛рддреНрд░рд╛: {quantity} рдореАрдЯрд░

ЁЯТ░ *рд░рд╛рд╢рд┐ рд╡рд┐рд╡рд░рдг:*
- рдХреБрд▓ рд░рд╛рд╢рд┐: тВ╣{fabric_total}
- рдЬрдорд╛ рд░рд╛рд╢рд┐: тВ╣{advance_payment}
- рдмрдХрд╛рдпрд╛: тВ╣{remaining_amount}

ЁЯОБ *рд╡рд┐рд╢реЗрд╖ рдСрдлрд░:*
рдЗрд╕реА рдХрдкрдбрд╝реЗ рдХреА рд╕рд┐рд▓рд╛рдИ рдкрд░ 5% рдЫреВрдЯ!

ЁЯУН рдХреГрдкрдпрд╛ рдЬрд▓реНрдж рд╕реЗ рдЬрд▓реНрдж рдЕрдкрдирд╛ рдХрдкрдбрд╝рд╛ рд▓реЗ рдЬрд╛рдПрдВред

рд╕рдВрдкрд░реНрдХ: {shop_phone}
*RS Tailor & Fabric*
Main Market, Kumher`;
    }

    getFabricPaymentReminderTemplate() {
        return `ЁЯТ│ *рдХрдкрдбрд╝реЗ рдХрд╛ рднреБрдЧрддрд╛рди рдмрд╛рдХреА рд╣реИ* ЁЯТ│

рдкреНрд░рд┐рдп *{customer_name}* рдЬреА,

рдЖрдкрдХреЗ рдХрдкрдбрд╝реЗ рдХреЗ рдСрд░реНрдбрд░ #F{order_id} рдХрд╛ рднреБрдЧрддрд╛рди рдЕрднреА рднреА рдмрд╛рдХреА рд╣реИред

ЁЯУж *рд╡рд┐рд╡рд░рдг:*
- рдХрдкрдбрд╝рд╛: {fabric_type} - {brand_name}
- рдорд╛рддреНрд░рд╛: {quantity} рдореАрдЯрд░
- рдмрдХрд╛рдпрд╛ рд░рд╛рд╢рд┐: тВ╣{remaining_amount}

рдХреГрдкрдпрд╛ рдЬрд▓реНрдж рднреБрдЧрддрд╛рди рдХрд░реЗрдВ:
ЁЯУ▒ UPI: 8824781960@paytm

рдзрдиреНрдпрд╡рд╛рдж! ЁЯЩП
*RS Tailor & Fabric*
Main Market, Kumher`;
    }

    // Combined Templates
    getCombinedOrderTemplate() {
        return `тЬЕ рдЖрдкрдХрд╛ Fabric Purchase Complete рдФрд░ Tailoring Order Confirm рд╣реЛ рдЧрдпрд╛ рд╣реИ! 

рдирдорд╕реНрддреЗ *{customer_name}* рдЬреА ЁЯЩП

ЁЯСЙ рдЖрдкрдХрд╛ Fabric Order тЬи
ЁЯУЛ Order ID: {fabric_order_id}
ЁЯУП Quantity: {fabric_quantity} meters
ЁЯУЕ Purchase Date: {fabric_purchase_date}

ЁЯТ░ Payment Details:
- Total Amount: тВ╣{fabric_total}
- Advance Payment: тВ╣{fabric_advance}
- Remaining Amount: тВ╣{fabric_remaining}

ЁЯСЙ рдЖрдкрдХрд╛ Tailoring Order тЬи
- Order ID: {tailor_order_id}
- Item: {garment_type} ЁЯСФ
- Ready рд╣реЛрдЧрд╛: {delivery_date}

ЁЯТ░ Amount Details:
- Total: тВ╣{tailor_total}
- Advance рдорд┐рд▓рд╛: тВ╣{tailor_advance} тЬУ
- рдмрд╛рдХреА Amount: тВ╣{tailor_remaining}

ЁЯПк Shop Details:
- Timing: 10:00 AM - 8:00 PM
- Phone: {shop_phone}

рд╣рдорд╛рд░реА рджреБрдХрд╛рди рдкрд░ рдЖрдиреЗ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж ! ЁЯЩП

*RS Tailor & Fabric* ЁЯШК
Main Market, Kumher`;
    }

    // Special Templates
    getPickupCompleteTemplate() {
        return `ЁЯз╛ Order Pickup Complete! ЁЯз╛

рдкреНрд░рд┐рдп *{customer_name}* рдЬреА ЁЯда

рдЖрдЬ ({pickup_date}) рдЖрдкрдиреЗ рдЕрдкрдирд╛ {garment_type} (Order #{order_id}) successfully рд▓реЗ рд▓рд┐рдпрд╛! ЁЯОЙ

ЁЯТ│ Payment Summary:
- Total Amount: тВ╣{total_amount}
- рдкрд╣рд▓реЗ рд╕реЗ рдЬрдорд╛: тВ╣{advance_amount}
- рдЖрдЬ рджрд┐рдпрд╛: тВ╣{final_payment}
- рдмрдХрд╛рдпрд╛ рд░рд╛рд╢рд┐: тВ╣{remaining_amount}

ЁЯСХ Care Instructions:
- рд╣рд▓реНрдХреЗ рд╣рд╛рде рд╕реЗ Wash рдХрд░реЗрдВ
- рдЙрд▓реНрдЯрд╛ рдХрд░рдХреЗ Iron рдХрд░реЗрдВ
- Dry Clean рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ

ЁЯТл рдирдпреЗ Order рдХреЗ рд▓рд┐рдП рджреБрдмрд╛рд░рд╛ рдЬрд░реВрд░ рдЖрдП !

Again Thank You 
*RS Tailor & Fabric* тЬи
Main Market, Kumher`;
    }

    // Festival Promotional Templates
    getDurgaPujaDussehraOfferTemplate() {
        return `ЁЯЩП *рдирдорд╕реНрддреЗ {customer_name} рдЬреА* ЁЯЩП

ЁЯМ║ *рджреБрд░реНрдЧрд╛ рдкреВрдЬрд╛ рдФрд░ рджрд╢рд╣рд░рд╛ рдХреА рд╣рд╛рд░реНрджрд┐рдХ рд╢реБрднрдХрд╛рдордирд╛рдПрдВ* ЁЯМ║

рдЗрд╕ рдкрд╛рд╡рди рдЕрд╡рд╕рд░ рдкрд░ рд╣рдо рдЖрдкрдХреЗ рдФрд░ рдЖрдкрдХреЗ рдкреВрд░реЗ рдкрд░рд┐рд╡рд╛рд░ рдХреА рдЕрдЪреНрдЫреА рд╕реЗрд╣рдд рдФрд░ рдЦреБрд╢рд╣рд╛рд▓реА рдХреА рдкреНрд░рд╛рд░реНрдердирд╛ рдХрд░рддреЗ рд╣реИрдВред рдорд╛рдБ рджреБрд░реНрдЧрд╛ рдЖрдк рд╕рднреА рдкрд░ рдЕрдкрдиреА рдХреГрдкрд╛ рдмрдирд╛рдП рд░рдЦреЗрдВред ЁЯЩПтЬи

ЁЯОЙ *рдЗрд╕ рджрд╢рд╣рд░реЗ рдХреЛ рдмрдирд╛рдЗрдП рдЦрд╛рд╕ рд╣рдорд╛рд░реЗ рдмреЗрд╣рддрд░реАрди рдСрдлрд░ рдХреЗ рд╕рд╛рде!* ЁЯОЙ

рдЖрдк рд╣рдорд╛рд░реЗ рдирд┐рдпрдорд┐рдд рдФрд░ рдкреНрд░рд┐рдп рдЧреНрд░рд╛рд╣рдХ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ *25% рдХреА рдЫреВрдЯ*:

ЁЯТ░ *рд╡рд┐рд╢реЗрд╖ рдСрдлрд░:*
тЦкя╕П тВ╣1000 рдХреА рдЦрд░реАрджрд╛рд░реА рдкрд░ рд╕реАрдзреЗ тВ╣250 рдХреА рдЫреВрдЯ 
тЦкя╕П тВ╣2000 рдХреА рдЦрд░реАрджрд╛рд░реА рдкрд░ рд╕реАрдзреЗ тВ╣500 рдХреА рдЫреВрдЯ
тЦкя╕П рдХреЛрдИ рдЫреБрдкреА рд╣реБрдИ рд╢рд░реНрддреЗрдВ рдирд╣реАрдВ, рд╕реАрдзреА рд╕рд╛рджреА рдЫреВрдЯ!

ЁЯУЕ *рдСрдлрд░ рдХреА рдЕрд╡рдзрд┐:*
30 рд╕рд┐рддрдВрдмрд░ рд╕реЗ 2 рдЕрдХреНрдЯреВрдмрд░ рддрдХ (рдХреЗрд╡рд▓ 3 рджрд┐рди)
рдЖрдк рдЗрд╕ рджреМрд░рд╛рди рдХрднреА рднреА рдЖ рд╕рдХрддреЗ рд╣реИрдВред

ЁЯОп *рдпрд╣ рдСрдлрд░ рдХреЗрд╡рд▓ рдЖрдкрдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рд░рд╣реЗрдЧрд╛!*

ЁЯУН *RS Tailor & Fabric*
Main Market, Kumher
ЁЯУЮ *рд╕рдВрдкрд░реНрдХ:* 8824781960
тП░ *рд╕рдордп:* рд╕реБрдмрд╣ 10 рд╕реЗ рд░рд╛рдд 8 рдмрдЬреЗ

рдЬрдп рдорд╛рддрд╛ рджреА! ЁЯЪй
рдзрдиреНрдпрд╡рд╛рдж! ЁЯЩП`;
    }

    // Template Processing Methods
    getTemplate(templateType) {
        if (!this.templates[templateType]) {
            throw new Error(`Template type '${templateType}' not found`);
        }
        return this.templates[templateType];
    }

    processTemplate(templateType, data) {
        try {
            // Check cache first
            const cacheKey = `${templateType}_${JSON.stringify(data)}`;
            if (this.templateCache.has(cacheKey)) {
                return this.templateCache.get(cacheKey);
            }

            let template = this.getTemplate(templateType);
            
            // Replace placeholders with actual data
            template = this.replacePlaceholders(template, data);
            
            // Cache the processed template
            this.templateCache.set(cacheKey, template);
            
            // Limit cache size
            if (this.templateCache.size > 100) {
                const firstKey = this.templateCache.keys().next().value;
                this.templateCache.delete(firstKey);
            }
            
            return template;
            
        } catch (error) {
            logger.error('Template processing failed:', error);
            throw error;
        }
    }

    replacePlaceholders(template, data) {
        // Default values for missing data
        const defaults = {
            shop_name: 'RS Tailor & Fabric',
            shop_phone: '8824781960',
            business_hours: '10:00 AM - 8:00 PM',
            customer_name: 'Customer',
            order_id: 'N/A',
            garment_type: 'Item',
            total_amount: '0',
            advance_payment: '0',
            remaining_amount: '0',
            ready_date: new Date().toLocaleDateString(),
            delivery_date: new Date().toLocaleDateString(),
            pickup_date: new Date().toLocaleDateString(),
            order_date: new Date().toLocaleDateString(),
            outstanding_amount: '0',
            paid_today: '0',
            final_payment: '0',
            fabric_type: 'Fabric',
            brand_name: 'Brand',
            fabric_order_id: 'N/A',
            tailor_order_id: 'N/A',
            fabric_total: '0',
            fabric_advance: '0',
            fabric_remaining: '0',
            fabric_quantity: '0',
            fabric_purchase_date: new Date().toLocaleDateString(),
            tailor_total: '0',
            tailor_advance: '0',
            tailor_remaining: '0',
            quantity: '0',
            notes: 'N/A',
            days_since_ready: '0'
        };

        // Merge data with defaults
        const mergedData = { ...defaults, ...data };

        // Replace placeholders
        let processedTemplate = template;
        for (const [key, value] of Object.entries(mergedData)) {
            const placeholder = `{${key}}`;
            processedTemplate = processedTemplate.replace(new RegExp(placeholder, 'g'), value);
        }

        return processedTemplate;
    }

    // PROMOTIONAL CAMPAIGN ONLY - Other methods commented out
    
    /*
    // Public API Methods (compatible with existing code) - DISABLED for promotional campaign
    getWelcomeMessage(orderData) {
        return this.processTemplate('welcome', orderData);
    }

    getOrderConfirmationMessage(orderData) {
        return this.processTemplate('order_confirmation', orderData);
    }

    getOrderReadyMessage(orderData) {
        return this.processTemplate('order_ready', orderData);
    }

    getDeliveryNotificationMessage(orderData) {
        return this.processTemplate('delivery_notification', orderData);
    }

    getPickupReminderMessage(orderData) {
        return this.processTemplate('pickup_reminder', orderData);
    }

    getPaymentReminderMessage(orderData) {
        return this.processTemplate('payment_reminder', orderData);
    }

    getFabricWelcomeMessage(orderData) {
        return this.processTemplate('fabric_welcome', orderData);
    }

    getFabricPurchaseMessage(orderData) {
        return this.processTemplate('fabric_purchase', orderData);
    }

    getFabricPaymentReminderMessage(orderData) {
        return this.processTemplate('fabric_payment_reminder', orderData);
    }

    getCombinedOrderMessage(orderData) {
        return this.processTemplate('combined_order', orderData);
    }

    getPickupCompleteMessage(orderData) {
        return this.processTemplate('pickup_complete', orderData);
    }
    */

    // Festival Promotional Methods
    getDurgaPujaDussehraOfferMessage(orderData) {
        return this.processTemplate('durga_puja_dussehra_offer', orderData);
    }

    // Template Management Methods
    addCustomTemplate(templateType, template) {
        this.templates[templateType] = template;
        console.log(`тЬЕ Custom template added: ${templateType}`);
    }

    updateTemplate(templateType, template) {
        if (!this.templates[templateType]) {
            throw new Error(`Template type '${templateType}' not found`);
        }
        this.templates[templateType] = template;
        this.clearTemplateCache();
        console.log(`тЬЕ Template updated: ${templateType}`);
    }

    removeTemplate(templateType) {
        if (!this.templates[templateType]) {
            throw new Error(`Template type '${templateType}' not found`);
        }
        delete this.templates[templateType];
        this.clearTemplateCache();
        console.log(`тЬЕ Template removed: ${templateType}`);
    }

    clearTemplateCache() {
        this.templateCache.clear();
        console.log('ЁЯз╣ Template cache cleared');
    }

    getAvailableTemplates() {
        return Object.keys(this.templates);
    }

    getTemplateStats() {
        return {
            totalTemplates: Object.keys(this.templates).length,
            cacheSize: this.templateCache.size,
            availableTypes: this.getAvailableTemplates()
        };
    }
}

module.exports = MessageTemplates;