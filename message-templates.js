const logger = require('pino')({ level: process.env.LOG_LEVEL || 'info' });

class MessageTemplates {
    constructor() {
        this.templates = {
            // Order Confirmation Messages
            order_confirmation_hindi: `тЬЕ Order Confirm рд╣реЛ рдЧрдпрд╛! тЬЕ

Hello *{customer_name}* рдЬреА ЁЯСЛ

рдЖрдкрдХрд╛ order confirm рд╣реИ рдФрд░ рд╣рдордиреЗ рдХрд╛рдо рд╢реБрд░реВ рдХрд░ рджрд┐рдпрд╛ рд╣реИ! ЁЯОп

ЁЯУЛ Order рдХреА Details:
- Order ID: {order_id}
- Item: {garment_type} ЁЯСФ
- Ready рд╣реЛрдЧрд╛: {delivery_date}

ЁЯТ░ Amount Details:
- Total: тВ╣{total_amount}
- Advance рдорд┐рд▓рд╛: тВ╣{advance_amount} тЬЕ
- рдмрд╛рдХреА Amount: тВ╣{remaining_amount}

ЁЯФФ рдЬреИрд╕реЗ рд╣реА ready рд╣реЛрдЧрд╛, рдЖрдкрдХреЛ message рднреЗрдЬ рджреЗрдВрдЧреЗ !
ЁЯПк Shop timing: {business_hours}

рд╣рдорд╛рд░реА рджреБрдХрд╛рди рдкрд░ рдЖрдиреЗ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж !ЁЯЩП

{shop_name} ЁЯШК
Phone: {shop_phone}

ЁЯПк RS Tailor & Fabric
ЁЯУН Main Market, Kumher`,


            // Order Ready for Pickup
            order_ready_hindi: `ЁЯОЙ рдЖрдкрдХрд╛ Order рддреИрдпрд╛рд░ рд╣реИ ! ЁЯОЙ

рдирдорд╕реНрддреЗ *{customer_name}* рдЬреА ЁЯЩП

рдЖрдкрдХрд╛ {garment_type} рдмрд┐рд▓реНрдХреБрд▓ ready рд╣реИ ! тЬи
ЁЯУЛ Order ID: {order_id}
ЁЯУЕ рддреИрдпрд╛рд░ рд╣реБрдЖ: {ready_date}

ЁЯТ░ Payment Details:
- рдХреБрд▓ Amount: тВ╣{total_amount}
- Advance рдЬрдорд╛: тВ╣{advance_amount}
- рдмрд╛рдХреА Amount: тВ╣{remaining_amount}

ЁЯПк Pickup Your Order:
- Shop time: {business_hours}
- рдЖрдЬ рд╣реА рдЖрдХрд░ рд▓реЗ рдЬрд╛рдПрдВ !

{shop_name} ЁЯШК
Phone: {shop_phone}

тнР рдЖрдкрдХрд╛ рднрд░реЛрд╕рд╛ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рд╕рдмрдХреБрдЫ рд╣реИ ! Thank You !

ЁЯПк RS Tailor & Fabric
ЁЯУН Main Market, Kumher`,


            // Payment Reminder
            payment_reminder_hindi: `ЁЯТ│ Payment Reminder ЁЯТ│

рдирдорд╕реНрддреЗ *{customer_name}* рдЬреА ЁЯЩП

рдЖрдкрдиреЗ Order {order_id} ({garment_type}) {order_date} рдХреЛ рд▓реЗ рд▓рд┐рдпрд╛ рдерд╛ред ЁЯОп  

рд▓реЗрдХрд┐рди рдЕрднреА тВ╣{outstanding_amount} рд╢реЗрд╖ рд╣реИ тАФ рдХреГрдкрдпрд╛ рд╕реБрд╡рд┐рдзрд╛ рдЕрдиреБрд╕рд╛рд░ рдЬрд▓реНрдж Payment рдХрд░ рджреАрдЬрд┐рдПред

ЁЯТ░ рднреБрдЧрддрд╛рди рд╡рд┐рдХрд▓реНрдк:
* Cash тАФ рджреБрдХрд╛рди рдкрд░ рдЖрдХрд░ рджреЗ рд╕рдХрддреЗ рд╣реИрдВ  
* UPI/Online тАФ рдиреАрдЪреЗ Pay here рдмрдЯрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ рдпрд╛ рднреБрдЧрддрд╛рди рдХреЗ рдмрд╛рдж PAID рднреЗрдЬ рджреЗрдВ

ЁЯПк Shop timing: {business_hours}
  
{shop_name} тЬи 
Call/WhatsApp: {shop_phone}

рдзрдиреНрдпрд╡рд╛рдж ЁЯЩП

ЁЯПк RS Tailor & Fabric
ЁЯУН Main Market, Kumher`,


            // Pickup Reminder
            pickup_reminder_hindi: `ЁЯФФ Pickup Reminder ЁЯФФ

Hello *{customer_name}* рдЬреА ЁЯШК

рдЖрдкрдХрд╛ order ready рд╣реИ! ЁЯОЙ
рдХрдм рд╕реЗ wait рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдЖрдкрдХрд╛...

ЁЯУЛ Order Info:
- ID: {order_id}
- Item: {garment_type}
- Ready since: {ready_date}

ЁЯПк Shop Details:
- Timings: {business_hours}
- Contact: {shop_phone}

ЁЯЪЧ рдЬрд▓реНрджреА рдЖ рдЬрд╛рдЗрдП - waiting рд╣реИ рдЖрдкрдХрд╛!

Thank You - {shop_name} ЁЯШК

ЁЯПк RS Tailor & Fabric
ЁЯУН Main Market, Kumher`,

            // Welcome Message (New Customer)
            welcome_hindi: `ЁЯЩП{shop_name} рдореЗрдВ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИ ! рдЖрдкрдХрд╛ рджрд┐рди рд╢реБрдн рд╣реЛ !ЁЯЩП

рдирдорд╕реНрддреЗ *{customer_name}* рдЬреА! ЁЯСЛ

рд╣рдорд╛рд░реЗ рд╕рд╛рде рдЬреБрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП thank you!
рдЖрдкрдХреА рд╣рд░ рдЬрд░реВрд░рдд рдкреВрд░реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдо рддреИрдпрд╛рд░ рд╣реИрдВ! тЬи

ЁЯПк Shop Information:
- Timings: {business_hours}
- 7 days open
- Contact: {shop_phone}
- WhatsApp updates automatic рдорд┐рд▓рддреЗ рд░рд╣реЗрдВрдЧреЗ !

ЁЯУ▒ рд╣рдорд╛рд░реА Service:
- Order status updates
- Ready рд╣реЛрдиреЗ рдкрд░ instant notification
- Payment reminders
- New collection alerts
- Festival/Wedding Offers ЁЯл┤ 

рдЖрдкрдХрд╛ рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╣реА рд╣рдорд╛рд░реА рд╕рдлрд▓рддрд╛ рд╣реИ! ЁЯЩП

ЁЯТл Best quality, Best Service - guaranteed!

ЁЯПк RS Tailor & Fabric
ЁЯУН Main Market, Kumher`,


            // Order Pickup Complete
            pickup_complete_hindi: `ЁЯз╛ Order Pickup Complete! ЁЯз╛

Dear *{customer_name}* рдЬреА ЁЯда

рдЖрдЬ ({pickup_date}) рдЖрдкрдиреЗ рдЕрдкрдирд╛ {garment_type} (Order {order_id}) successfully рд▓реЗ рд▓рд┐рдпрд╛! ЁЯОЙ

ЁЯТ│ Payment Summary:
- Total Amount: тВ╣{total_amount}
- рдкрд╣рд▓реЗ рд╕реЗ рдЬрдорд╛: тВ╣{advance_amount}
- рдЖрдЬ рджрд┐рдпрд╛: тВ╣{final_payment}
- рдмрдХрд╛рдпрд╛ рд░рд╛рд╢рд┐: тВ╣{remaining_amount}

ЁЯСХ Care Instructions:
- рд╣рд▓реНрдХреЗ рд╣рд╛рде рд╕реЗ Wash рдХрд░реЗрдВ
- рдЙрд▓реНрдЯрд╛ рдХрд░рдХреЗ Iron рдХрд░реЗрдВ
- Dry Clean рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ

ЁЯТл рдирдпреЗ Order рдХреЗ рд▓рд┐рдП рджреБрдмрд╛рд░рд╛ рдЬрд░реВрд░ рдЖрдП !

Again Thank You 
{shop_name} тЬи
Phone: {shop_phone}

ЁЯПк RS Tailor & Fabric
ЁЯУН Main Market, Kumher`,

            // Fabric Order Templates
            fabric_order_ready_hindi: `ЁЯОЙ *Fabric Order Ready!* ЁЯОЙ

рдирдорд╕реНрддреЗ *{customer_name}* рдЬреА ЁЯЩП

рдЖрдкрдХреА {fabric_type} ({brand_name}) Fabric Ready рд╣реИ! тЬи
ЁЯУЛ Order ID: {order_id}

ЁЯТ░ *Payment Details:*
- Total Amount: тВ╣{total_amount}

ЁЯПк *Pickup Your Fabric:*
- Shop time: {business_hours}
- рдЖрдЬ рд╣реА рдЖрдХрд░ рд▓реЗ рдЬрд╛рдПрдВ !

{shop_name} ЁЯШК
Phone: {shop_phone}

тнР рдЖрдкрдХрд╛ рднрд░реЛрд╕рд╛ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рд╕рдмрдХреБрдЫ рд╣реИ ! Thank You !

ЁЯПк RS Tailor & Fabric
ЁЯУН Main Market, Kumher`,

            // Combined Order Templates
            combined_order_ready_hindi: `ЁЯОЙ *Complete Order Ready!* ЁЯОЙ

рдирдорд╕реНрддреЗ *{customer_name}* рдЬреА ЁЯЩП

рдЖрдкрдХрд╛ Complete Order (Fabric + Tailoring) Ready рд╣реИ! тЬи
ЁЯУЛ Combined Order ID: {order_id}
ЁЯУЕ рддреИрдпрд╛рд░ рд╣реБрдЖ: {ready_date}

ЁЯУж *Order Components:*
- Fabric Order: {fabric_order_id}
- Tailor Order: {tailor_order_id}

ЁЯТ░ *Payment Details:*
- рдХреБрд▓ Amount: тВ╣{total_amount}
- Advance рдЬрдорд╛: тВ╣{advance_amount}
- рдмрд╛рдХреА Amount: тВ╣{remaining_amount}

ЁЯПк *Pickup Your Complete Order:*
- Shop time: {business_hours}
- рдЖрдЬ рд╣реА рдЖрдХрд░ рд▓реЗ рдЬрд╛рдПрдВ !

{shop_name} ЁЯШК
Phone: {shop_phone}

тнР рдЖрдкрдХрд╛ рднрд░реЛрд╕рд╛ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рд╕рдмрдХреБрдЫ рд╣реИ ! Thank You !

ЁЯПк RS Tailor & Fabric
ЁЯУН Main Market, Kumher`,

            // Delivery Notification
            delivery_notification_hindi: `ЁЯЪЪ рдЖрдкрдХрд╛ Order Deliver рд╣реЛ рдЧрдпрд╛! ЁЯЪЪ

рдирдорд╕реНрддреЗ *{customer_name}* рдЬреА ЁЯЩП

рдЖрдкрдХрд╛ Order {order_id} ({garment_type}) successfully deliver рд╣реЛ рдЧрдпрд╛ рд╣реИ! тЬи
ЁЯУЛ Order ID: {order_id}
ЁЯУЕ Delivery Date: {delivery_date}

ЁЯТ░ Payment Status:
- Total Amount: тВ╣{total_amount}
- Advance Payment: тВ╣{advance_amount}
- Remaining Amount: тВ╣{remaining_amount}

тЬЕ Order Successfully Delivered!

рдЕрдЧрд░ рдХреЛрдИ issue рд╣реИ рддреЛ contact рдХрд░реЗрдВ:
ЁЯУЮ Phone: {shop_phone}

рдЖрдкрдХреА рдЦреБрд╢реА рд╣реА рд╣рдорд╛рд░реА рд╕рдлрд▓рддрд╛ рд╣реИ! ЁЯЩП

{shop_name} ЁЯШК

ЁЯПк RS Tailor & Fabric
ЁЯУН Main Market, Kumher`,


            // Pickup Reminder Templates
            pickup_reminder_hindi: `ЁЯФФ *Pickup Reminder #{reminder_number}* ЁЯФФ

рдирдорд╕реНрддреЗ *{customer_name}* рдЬреА ЁЯЩП

рдЖрдкрдХрд╛ Order *{order_id}* ready рд╣реИ рдФрд░ {days_pending} рджрд┐рди рд╕реЗ рдЖрдкрдХреЗ pickup рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░ рд░рд╣рд╛ рд╣реИ! 

ЁЯУЛ Order Details:
- Order ID: {order_id}
- Item: {garment_type}
- Ready Date: {ready_date}
- Days Pending: {days_pending} рджрд┐рди

ЁЯТ░ Payment Status:
- Total Amount: тВ╣{total_amount}
- Advance Payment: тВ╣{advance_amount}
- Remaining Amount: тВ╣{remaining_amount}

тЪая╕П рдХреГрдкрдпрд╛ рдЬрд▓реНрджреА рд╕реЗ рдЕрдкрдирд╛ order pickup рдХрд░ рд▓реЗрдВ!

ЁЯПк Shop Details:
- Timing: 10:00 AM - 7:00 PM
- Phone: {shop_phone}
- Address: {shop_address}

рдЖрдкрдХрд╛ order safe рд╣реИ, рд▓реЗрдХрд┐рди рдХреГрдкрдпрд╛ рдЬрд▓реНрджреА pickup рдХрд░реЗрдВ! ЁЯЩП

{shop_name} ЁЯШК

ЁЯПк RS Tailor & Fabric
ЁЯУН Main Market, Kumher`,


            // Payment Reminder Templates
            payment_reminder_hindi: `ЁЯТ│ *Payment Reminder #{reminder_number}* ЁЯТ│

рдирдорд╕реНрддреЗ *{customer_name}* рдЬреА ЁЯЩП

рдЖрдкрдХрд╛ Order *{order_id}* deliver рд╣реЛ рдЧрдпрд╛ рд╣реИ рд▓реЗрдХрд┐рди payment pending рд╣реИ!

ЁЯУЛ Order Details:
- Order ID: {order_id}
- Item: {garment_type}
- Delivery Date: {delivery_date}
- Days Since Delivery: {days_pending} рджрд┐рди

ЁЯТ░ Payment Details:
- Total Amount: тВ╣{total_amount}
- Advance Payment: тВ╣{advance_amount}
- *Remaining Amount: тВ╣{remaining_amount}*

тЪая╕П рдХреГрдкрдпрд╛ рдмрд╛рдХреА payment рдЬрд▓реНрджреА рд╕реЗ complete рдХрд░реЗрдВ!

ЁЯПк Payment Options:
- Cash Payment at Shop
- UPI: {shop_phone}
- Timing: 10:00 AM - 7:00 PM

рдЖрдкрдХрд╛ payment рд╣рдорд╛рд░реЗ рд▓рд┐рдП important рд╣реИ! ЁЯЩП

{shop_name} ЁЯШК

ЁЯПк RS Tailor & Fabric
ЁЯУН Main Market, Kumher`,


            // Fabric Order Templates
            fabric_welcome_hindi: `ЁЯЩП{shop_name} рдореЗрдВ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИ ! рдЖрдкрдХрд╛ рджрд┐рди рд╢реБрдн рд╣реЛ !ЁЯЩП

рдирдорд╕реНрддреЗ *{customer_name}* рдЬреА! ЁЯСЛ

рд╣рдорд╛рд░реЗ рд╕рд╛рде рдЬреБрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП thank you!
рдЖрдкрдХреА рд╣рд░ рдЬрд░реВрд░рдд рдкреВрд░реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдо рддреИрдпрд╛рд░ рд╣реИрдВ! тЬи

ЁЯПк Shop Information:
- Timings: {business_hours}
- 7 days open
- Contact: {shop_phone}
- WhatsApp updates automatic рдорд┐рд▓рддреЗ рд░рд╣реЗрдВрдЧреЗ !

ЁЯУ▒ рд╣рдорд╛рд░реА Service:
- Order status updates
- Ready рд╣реЛрдиреЗ рдкрд░ instant notification
- Payment reminders
- New collection alerts
- Festival/Wedding Offers ЁЯл┤ 

рдЖрдкрдХрд╛ рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╣реА рд╣рдорд╛рд░реА рд╕рдлрд▓рддрд╛ рд╣реИ! ЁЯЩП

ЁЯТл Best quality, Best Service - guaranteed!`,


            fabric_purchase_hindi: `ЁЯз╡ рдЖрдкрдХрд╛ Fabric Purchase Complete! ЁЯз╡

рдирдорд╕реНрддреЗ *{customer_name}* рдЬреА ЁЯЩП

рдЖрдкрдХрд╛ Fabric Order *{order_id}* successfully purchase рд╣реЛ рдЧрдпрд╛ рд╣реИ! тЬи
ЁЯУЛ Order ID: {order_id}
ЁЯз╡ Fabric: {fabric_type} ({fabric_color})
ЁЯУП Quantity: {quantity} meters
ЁЯУЕ Purchase Date: {purchase_date}

ЁЯТ░ Payment Details:
- Total Amount: тВ╣{total_amount}
- Advance Payment: тВ╣{advance_payment}
- Remaining Amount: тВ╣{remaining_amount}

тЬЕ Fabric Purchase Completed!

рдЕрдЧрд░ рдХреЛрдИ issue рд╣реИ рддреЛ contact рдХрд░реЗрдВ:
ЁЯУЮ Phone: {shop_phone}

рдЖрдкрдХреА рдЦреБрд╢реА рд╣реА рд╣рдорд╛рд░реА рд╕рдлрд▓рддрд╛ рд╣реИ! ЁЯЩП

{shop_name} ЁЯШК`,


            fabric_payment_reminder_hindi: `ЁЯТ│ *Fabric Payment Reminder #{reminder_number}* ЁЯТ│

рдирдорд╕реНрддреЗ *{customer_name}* рдЬреА ЁЯЩП

рдЖрдкрдХрд╛ Fabric Order *{order_id}* purchase рд╣реЛ рдЧрдпрд╛ рд╣реИ рд▓реЗрдХрд┐рди payment pending рд╣реИ!

ЁЯУЛ Order Details:
- Order ID: {order_id}
- Fabric: {fabric_type} ({fabric_color})
- Purchase Date: {purchase_date}
- Days Since Purchase: {days_pending} рджрд┐рди

ЁЯТ░ Payment Details:
- Total Amount: тВ╣{total_amount}
- Advance Payment: тВ╣{advance_payment}
- *Remaining Amount: тВ╣{remaining_amount}*

тЪая╕П рдХреГрдкрдпрд╛ payment рдЬрд▓реНрджреА рд╕реЗ complete рдХрд░реЗрдВ!

ЁЯПк Payment Options:
- Cash Payment at Shop
- UPI: {shop_phone}
- Timing: {business_hours}

рдЖрдкрдХрд╛ payment рд╣рдорд╛рд░реЗ рд▓рд┐рдП important рд╣реИ! ЁЯЩП

{shop_name} ЁЯШК`,


            // Combined Order Templates
            combined_order_hindi: `тЬЕ рдЖрдкрдХрд╛ Fabric Purchase Complete рдФрд░ Tailoring Order Confirm рд╣реЛ рдЧрдпрд╛ рд╣реИ! 

рдирдорд╕реНрддреЗ *{customer_name}* рдЬреА ЁЯЩП


ЁЯСЙ рдЖрдкрдХрд╛ Fabric Order тЬи
ЁЯУЛ Order ID: {fabric_order_id}
ЁЯз╡ Fabric: {fabric_type} ({fabric_color})
ЁЯУП Quantity: {fabric_quantity} meters
ЁЯУЕ Purchase Date: {fabric_purchase_date}

ЁЯТ░ Payment Details:
- Total Amount: тВ╣{fabric_total_amount}
- Advance Payment: тВ╣{fabric_advance_payment}
- Remaining Amount: тВ╣{fabric_remaining_amount}


ЁЯСЙ рдЖрдкрдХрд╛ Tailoring Order тЬи
- Order ID: {tailoring_order_id}
- Item: {tailoring_garment_type} ЁЯСФ
- Ready рд╣реЛрдЧрд╛: {tailoring_delivery_date}

ЁЯТ░ Amount Details:
- Total: тВ╣{tailoring_total_amount}
- Advance рдорд┐рд▓рд╛: тВ╣{tailoring_advance_payment} тЬЕ
- рдмрд╛рдХреА Amount: тВ╣{tailoring_remaining_amount}


ЁЯПк Shop Details:
- Timing: {business_hours}
- Phone: {shop_phone}

рд╣рдорд╛рд░реА рджреБрдХрд╛рди рдкрд░ рдЖрдиреЗ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж ! ЁЯЩП

{shop_name} ЁЯШК
Main Market, Kumher.`,


            // Worker Daily Data Messages
            worker_daily_data_hindi: `ЁЯУК *рджреИрдирд┐рдХ рдХрд╛рд░реНрдп рд░рд┐рдкреЛрд░реНрдЯ* ЁЯУК

рдирдорд╕реНрддреЗ *{worker_name}* рдЬреА! ЁЯЩП

рдЖрдЬ рдХреА рдЖрдкрдХреА рдХрд╛рд░реНрдп рд░рд┐рдкреЛрд░реНрдЯ рдпрд╣рд╛рдБ рд╣реИ:

ЁЯУЕ *рджрд┐рдирд╛рдВрдХ:* {date}
ЁЯСд *рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдирд╛рдо:* {worker_name}
ЁЯОи *рдкреЗрдВрдЯ рдХрд╛рдЙрдВрдЯ:* {paint_count}
ЁЯСФ *рд╢рд░реНрдЯ рдХрд╛рдЙрдВрдЯ:* {shirt_count}
ЁЯТ░ *рдХреБрд▓ рдХрд╛рд░реНрдп рд░рд╛рд╢рд┐:* тВ╣{total_work_amount}
ЁЯТ╡ *рдЕрдЧреНрд░рд┐рдо рд▓рд┐рдпрд╛ рдЧрдпрд╛:* тВ╣{advance_taken}
ЁЯТ╕ *рдмрд╛рдХреА рднреБрдЧрддрд╛рди:* тВ╣{remaining_payment}
ЁЯУЭ *рдиреЛрдЯреНрд╕:* {notes}

ЁЯУК *рдХреБрд▓ рдЧрдгрдирд╛:*
тАв рдХреБрд▓ рд░рд╛рд╢рд┐: тВ╣{grand_total_amount}
тАв рдХреБрд▓ рдЕрдЧреНрд░рд┐рдо: тВ╣{grand_total_advance}
тАв рдХреБрд▓ рдмрд╛рдХреА: тВ╣{grand_total_remaining}

ЁЯПк *RS Tailor & Fabric*
ЁЯУН Main Market, Kumher
ЁЯУЮ Phone: 8824781960

рдзрдиреНрдпрд╡рд╛рдж! ЁЯЩП`,

        };

        // Default shop configuration
        this.shopConfig = {
            shop_name: process.env.SHOP_NAME || 'RS Tailor & Fabric',
            shop_phone: process.env.SHOP_PHONE || '8824781960',
            shop_address: process.env.SHOP_ADDRESS || 'Main Market, Kumher',
            business_hours: process.env.BUSINESS_HOURS || '10:00 AM - 7:00 PM'
        };

        // Language preference (hindi/english)
        this.defaultLanguage = process.env.DEFAULT_LANGUAGE || 'hindi';
    }

    /**
     * Get template by type and language
     */
    getTemplate(templateType, language = null) {
        const lang = language || this.defaultLanguage;
        const templateKey = `${templateType}_${lang}`;
        
        if (this.templates[templateKey]) {
            return this.templates[templateKey];
        }
        
        // No fallback needed - only Hindi templates available
        
        logger.error(`Template not found: ${templateKey}`);
        return this.getDefaultTemplate(templateType);
    }

    /**
     * Get default template if specific template not found
     */
    getDefaultTemplate(templateType) {
        const defaultTemplates = {
            order_ready: `Your order #{order_id} is ready for pickup!\n\nCustomer: {customer_name}\nPhone: {customer_phone}\n\nPlease visit our shop during business hours.\n\n{shop_name}\n{shop_phone}`,
            payment_reminder: `Payment reminder for order #{order_id}\n\nOutstanding amount: тВ╣{outstanding_amount}\nCustomer: {customer_name}\n\nPlease make payment at your earliest convenience.\n\n{shop_name}\n{shop_phone}`,
            welcome: `ЁЯЩП{shop_name} рдореЗрдВ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИ ! рдЖрдкрдХрд╛ рджрд┐рди рд╢реБрдн рд╣реЛ !ЁЯЩП

рдирдорд╕реНрддреЗ *{customer_name}* рдЬреА! ЁЯСЛ

рд╣рдорд╛рд░реЗ рд╕рд╛рде рдЬреБрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП thank you!
рдЖрдкрдХреА рд╣рд░ рдЬрд░реВрд░рдд рдкреВрд░реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдо рддреИрдпрд╛рд░ рд╣реИрдВ! тЬи

ЁЯПк Shop Information:
- Timings: {business_hours}
- 7 days open
- Contact: {shop_phone}
- WhatsApp updates automatic рдорд┐рд▓рддреЗ рд░рд╣реЗрдВрдЧреЗ !

ЁЯУ▒ рд╣рдорд╛рд░реА Service:
- Order status updates
- Ready рд╣реЛрдиреЗ рдкрд░ instant notification
- Payment reminders
- New collection alerts
- Festival/Wedding Offers ЁЯл┤ 

рдЖрдкрдХрд╛ рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╣реА рд╣рдорд╛рд░реА рд╕рдлрд▓рддрд╛ рд╣реИ! ЁЯЩП

ЁЯТл Best quality, Best Service - guaranteed!`
        };
        
        return defaultTemplates[templateType] || `Message from {shop_name}\n\nHello {customer_name},\n\nThank you for your business!\n\n{shop_name}\n{shop_phone}`;
    }

    /**
     * Format template with data
     */
    formatTemplate(templateType, data, language = null) {
        try {
            const template = this.getTemplate(templateType, language);
            
            // Merge shop config with data
            const formattedData = {
                ...this.shopConfig,
                ...data,
                // Ensure dates are formatted properly
                ready_date: this.formatDate(data.ready_date),
                delivery_date: this.formatDate(data.delivery_date),
                pickup_date: this.formatDate(data.pickup_date),
                order_date: this.formatDate(data.order_date),
                due_date: this.formatDate(data.due_date)
            };
            
            // Replace template variables
            let formattedMessage = template;
            Object.keys(formattedData).forEach(key => {
                const value = formattedData[key] || '';
                const regex = new RegExp(`{${key}}`, 'g');
                formattedMessage = formattedMessage.replace(regex, value);
            });
            
            // Clean up any remaining unreplaced variables
            formattedMessage = formattedMessage.replace(/{[^}]+}/g, '');
            
            return formattedMessage;
        } catch (error) {
            logger.error('Error formatting template:', error.message);
            return this.getDefaultTemplate(templateType);
        }
    }

    /**
     * Format date to readable string
     */
    formatDate(dateString) {
        if (!dateString) return '';
        
        try {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-IN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        } catch (error) {
            return dateString;
        }
    }

    /**
     * Determine order type and get appropriate template
     */
    getOrderReadyMessage(orderData, language = null) {
        const { garment_type, fabric_type, fabric_order_id, tailor_order_id } = orderData;
        
        // Check if it's a combined order (fabric + tailoring)
        if (fabric_order_id && tailor_order_id) {
            return this.formatTemplate('combined_order_ready', orderData, language);
        }
        
        // Check if it's a fabric-only order
        if (fabric_type && !garment_type) {
            return this.formatTemplate('fabric_order_ready', orderData, language);
        }
        
        // Default to regular order
        return this.formatTemplate('order_ready', orderData, language);
    }

    /**
     * Get payment reminder message
     */
    getPaymentReminderMessage(orderData, language = null) {
        return this.formatTemplate('payment_reminder', orderData, language);
    }

    /**
     * Get welcome message for new customer
     */
    getWelcomeMessage(customerData, language = null) {
        return this.formatTemplate('welcome', customerData, language);
    }

    /**
     * Get pickup complete message
     */
    getPickupCompleteMessage(orderData, language = null) {
        return this.formatTemplate('pickup_complete', orderData, language);
    }

    /**
     * Get pickup reminder message
     */
    getPickupReminderMessage(orderData, language = null) {
        return this.formatTemplate('pickup_reminder', orderData, language);
    }

    /**
     * Get order confirmation message
     */
    getOrderConfirmationMessage(orderData, language = null) {
        return this.formatTemplate('order_confirmation', orderData, language || 'hindi');
    }

    /**
     * Get delivery notification message
     */
    getDeliveryNotificationMessage(orderData, language = null) {
        return this.formatTemplate('delivery_notification', orderData, language);
    }

    // Note: getPickupReminderMessage is defined above; removing duplicate to prevent accidental overrides

    /**
     * Get fabric welcome message
     */
    getFabricWelcomeMessage(orderData, language = null) {
        return this.formatTemplate('fabric_welcome', orderData, language);
    }

    /**
     * Get fabric purchase notification message
     */
    getFabricPurchaseMessage(orderData, language = null) {
        return this.formatTemplate('fabric_purchase', orderData, language);
    }

    /**
     * Get fabric payment reminder message
     */
    getFabricPaymentReminderMessage(orderData, language = null) {
        return this.formatTemplate('fabric_payment_reminder', orderData, language);
    }

    /**
     * Get combined order message
     */
    getCombinedOrderMessage(orderData, language = null) {
        return this.formatTemplate('combined_order', orderData, language);
    }

    /**
     * Get worker daily data message
     */
    getWorkerDailyDataMessage(workerData, language = 'hindi') {
        return this.formatTemplate('worker_daily_data', workerData, 'hindi');
    }

    /**
     * Add custom template
     */
    addTemplate(templateType, template, language = 'english') {
        const templateKey = `${templateType}_${language}`;
        this.templates[templateKey] = template;
        logger.info(`Added custom template: ${templateKey}`);
    }

    /**
     * Update shop configuration
     */
    updateShopConfig(config) {
        this.shopConfig = { ...this.shopConfig, ...config };
        logger.info('Updated shop configuration');
    }

    /**
     * Get all available templates
     */
    getAvailableTemplates() {
        // Correctly parse template type and language by splitting on the last underscore
        return Object.keys(this.templates).map(key => {
            const lastUnderscore = key.lastIndexOf('_');
            const type = lastUnderscore > -1 ? key.substring(0, lastUnderscore) : key;
            const language = lastUnderscore > -1 ? key.substring(lastUnderscore + 1) : this.defaultLanguage;
            return { type, language };
        });
    }

    /**
     * Set default language
     */
    setDefaultLanguage(language) {
        this.defaultLanguage = language;
        logger.info(`Default language set to: ${language}`);
    }
}

module.exports = MessageTemplates;
